# NFR.md — Таблица требований безопасности

| ID     | Название                | Описание                                                        | Метрика / Порог                                                                                       | Проверка (чем/где)                                       | Компонент  | Приоритет |
|--------|-------------------------|-----------------------------------------------------------------|-------------------------------------------------------------------------------------------------------|----------------------------------------------------------|------------|-----------|
| NFR-01 | p95 задержка API        | Базовые GET ручки отвечают быстро при умеренной нагрузке        | p95 <= **300 ms** для `GET /wishes` и `GET /wishes?price<` при **30 RPS**, набор данных >= 50 записей | Нагрузочный тест                                         | API        | High      |
| NFR-02 | Стабильность 5xx        | Неверные входные данные не приводят к 5xx                       | >= 30 запросов **5xx = 0**; ожидаемые **4xx**                                                         | Юнит-тесты                                               | Validation | High      |
| NFR-03 | Пропускная способность  | Сервис держит стабильную нагрузку без деградации                | Устойчиво **30 RPS 5 мин**, **5xx < 1%**, ошибки таймаутов = 0                                        | Нагрузочный тест                                         | API        | Medium    |
| NFR-04 | Уязвимости зависимостей | Нет критичных и высоких уязвимостей в зависимостях              | High/Critical = 0; открытый High/Critical <= **7 дней**                                               | **pip-audit**                                            | Build      | High      |
| NFR-05 | Хеширование паролей     | (На будущее) Пользовательские пароли хранятся безопасно         | **Argon2id**: time_cost >= 2; memory_cost >= **64 MiB**; parallelism >= 2; salt 16B;                  | Юнит-тест параметров + бенчмарк pytest                   | Auth       | High      |
| NFR-06 | Секреты и конфигурация  | Секреты не коммитятся, не пишутся в логи и регулярно ротируются | **gitleaks = 0**; ротация **<= 30 дней**                                                              | **gitleaks** pre-commit                                  | Repo       | High      |
| NFR-07 | Токены                  | (На будущее) Сессии имеют ограниченный TTL                      | Access TTL <= **15 мин**; Refresh TTL <= **7 дней**                                                   | Юнит-тест верификации + интеграционный тест по истечении | Auth       | Medium    |
| NFR-08 | Аудит-лог               | Критичные действия пишут аудит-события                          | Для `POST/PATCH/DELETE` создаётся JSON-событие `{correlation_id, actor, action, resource, result}`    | Интеграционный тест + проверка формата логов             | Logging    | Medium    |
| NFR-09 | Минимизация данных      | Храним только необходимые поля ПДн                              | Доля "лишних" полей = 0%                                                                              | Pytest контракт-тесты                                    | API/DB     | High      |
| NFR-10 | Маскирование ПДн в API  | Чувствительные поля маскируются в ответах                       | >= 95% ответов по выборке не содержат полных ПДн; формат маски: `e***@g****.com`, `+7***`             | Интеграционный тест выборки                              | API        | High      |
