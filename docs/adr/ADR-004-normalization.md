# ADR-004: Нормализация дат и денежных значений
Дата: 2025-10-15  
Статус: Accepted

## Context
В системе используются поля `price_estimate` и `updated_at`. Использование `float` и локального времени может привести к ошибкам округления и несогласованности данных. Необходимо ввести единый формат для хранения и передачи этих значений.

Рассматривались варианты:
- Хранить цены как `float`, даты как `datetime.now()`.
- Использовать `Decimal` для цен и `datetime` в UTC.
- Приводить значения к локальной временной зоне пользователя.

## Decision
Принято использовать:
- `Decimal` для всех денежных значений с двумя знаками после запятой.
- Все даты сохраняются и обрабатываются в **UTC**.
- Конвертация в локальное время (если потребуется) выполняется только на клиенте.

## Consequences
**Плюсы:**
- Устранение ошибок округления при расчетах.
- Единый формат времени во всех системах.
- Повышается точность и воспроизводимость тестов.

**Минусы:**
- Требуется конвертация при отображении пользователю.
- Чуть более сложная сериализация `Decimal` в JSON.

## Security impact
Использование Decimal и UTC устраняет ошибки округления, защищает от искажения цен и обеспечивает целостность временных меток.

## Rollout plan #24

## Links
- NFR-10 (маскирование и формат)
- F8/R6 (чувствительных данных)
- tests/test_errors.py::test_price_normalization
- tests/test_errors.py::test_datetime_normalization
- tests/test_errors.py::test_decimal_serialization
