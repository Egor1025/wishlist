# STRIDE.md — Угрозы и контроли

| Поток/Элемент | Угроза (STRIDE)           | Риск | Контроль                                                           | Ссылка на NFR  | Проверка / Артефакт                                                                                |
|---------------|---------------------------|------|--------------------------------------------------------------------|----------------|----------------------------------------------------------------------------------------------------|
| **F1**        | T: Tampering              | R1   | Использование HTTPS, запрет HTTP                                   | NFR-03         | Локальный curl с проверкой сертификата                                                             |
| **F2**        | D: DoS                    | R2   | Ограничение RPS, валидация до бизнес-логики, p95 ≤ 300 мс          | NFR-01, NFR-03 | Нагрузочный тест 30 RPS 5 мин                                                                      |
| **F3**        | T: Tampering              | R3   | Посторонние поля -> 422, 5хх = 0                                   | NFR-09         | [test_invalid_inputs_return_4xx](../../tests/test_errors.py)                                       |
| **F4**        | I: Information Disclosure | R4   | Конвертация `ValidationError` -> контролируемый 422 JSON           | NFR-02, NFR-06 | Ручная проверка через Swagger UI (422 без стектрейса)                                              |
| **F5a**       | T: Tampering              | R5   | Атомарная генерация id / защита от гонок при записи                | NFR-03, NFR-09 | pytest + стресс-тест параллельных POST через asyncio                                               |
| **F5b**       | I: Information Disclosure | R6   | Минимизация выдачи, отсутствие служебных полей в ответах           | NFR-10         | [test_crud_wish](../../tests/test_errors.py)                                                       |
| **F6**        | I: Information Disclosure | R7   | Единый конверт ошибок без стектрейса                               | NFR-02, NFR-06 | Ручная проверка JSON-ответов через Swagger                                                         |
| **F7**        | I: Information Disclosure | R8   | Стабильный формат ответа 4xx/5xx                                   | NFR-02, NFR-06 | [test_validation_error](../../tests/test_errors.py)                                                |
| **F8**        | I: Information Disclosure | R9   | Маскирование ПДн                                                   | NFR-10         | Интеграционные тесты ответов                                                                       |
| **F9**        | R: Repudiation            | R10  | Формат события `{correlation_id, actor, action, resource, result}` | NFR-08         | Лог-парсер CI проверяет структуру audit.log (формат JSON)                                          |
| **F10**       | R: Repudiation            | R11  | Надёжная запись событий аудита в хранилище                         | NFR-08         | [test_audit_log_emitted_on_delete](../../tests/test_errors.py)                                     |
| **F11**       | I: Information Disclosure | R12  | Контракт ответа                                                    | NFR-10         | Проверка загаловков `Content-Type: application/json`, [test_crud_wish](../../tests/test_errors.py) |
